<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coger Agri Admin Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
  /* (Insert all your previous admin CSS here, including themes, layout, buttons, tables, forms, etc.) */
</style>
</head>
<body>
<div class="sidebar" role="navigation" aria-label="Primary sidebar">
  <div class="logo">ğŸŒ¾ Coger Agri</div>
  <div class="menu-item active" data-section="dashboard" tabindex="0">ğŸ“Š Dashboard</div>
  <div class="menu-item" data-section="products" tabindex="0">ğŸ“¦ Products</div>
  <div class="menu-item" data-section="orders" tabindex="0">ğŸ›’ Orders</div>
  <div class="menu-item" data-section="customers" tabindex="0">ğŸ‘¥ Customers</div>
  <div class="menu-item" data-section="analytics" tabindex="0">ğŸ“ˆ Analytics</div>
  <div class="menu-item" data-section="finances" tabindex="0">ğŸ’° Finances</div>
  <div class="menu-item" data-section="loyalty" tabindex="0">â­ Loyalty</div>
  <div class="menu-item" data-section="reviews" tabindex="0">ğŸ—£ Reviews</div>
</div>

<div class="main" role="main" tabindex="0">
  <div class="top-bar">
    <div class="title">Admin Dashboard</div>
    <div>
      Admin User ğŸŒ±
      <button id="themeToggleBtn" class="btn-warn" aria-pressed="false" aria-label="Toggle dark mode">ğŸŒ™ Dark Mode</button>
    </div>
  </div>

  <div id="dashboard" class="section active" tabindex="0">
    <h2>Welcome to Coger Agri Admin Dashboard</h2>
    <p>Use this dashboard to manage products, finances, loyalty points, and customer reviews.</p>
    <!-- Add your dashboard summary content -->
  </div>

  <div id="products" class="section" tabindex="0" style="display:none;">
    <h2>Product Management</h2>
    <button id="addNewProductBtn" class="btn-primary" style="margin-bottom: 10px;">Add New Product</button>
    <div id="productFormContainer" style="display:none; margin-bottom: 20px;">
      <form id="productForm">
        <label for="productName">Name</label>
        <input type="text" id="productName" required style="width:100%; margin-bottom:8px;" />
        <label for="productCategory">Category</label>
        <select id="productCategory" required style="width:100%; margin-bottom:8px;">
          <option value="" disabled selected>Select category</option>
          <option value="Cocopeat">Cocopeat</option>
          <option value="Oil">Oil</option>
          <option value="Coconut">Coconut</option>
          <option value="Copra">Copra</option>
          <option value="Charcoal">Charcoal</option>
        </select>
        <label for="productPrice">Price (â‚¹)</label>
        <input type="number" id="productPrice" min="0" step="0.01" required style="width:100%; margin-bottom:8px;" />
        <label for="productStock">Stock Quantity</label>
        <input type="number" id="productStock" min="0" required style="width:100%; margin-bottom:8px;" />
        <label for="productDesc">Description</label>
        <textarea id="productDesc" rows="3" style="width:100%; margin-bottom:8px;"></textarea>
        <button type="submit" class="btn-success">Save Product</button>
        <button type="button" id="cancelProductBtn" class="btn-danger" style="margin-left:10px;">Cancel</button>
      </form>
    </div>
    <table id="productsTable" style="width: 100%;">
      <thead>
        <tr><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Description</th><th>Actions</th></tr>
      </thead>
      <tbody id="productsList"></tbody>
    </table>
  </div>

  <!-- Repeat similar section structures for Orders, Customers, Analytics, Finances -->

  <div id="loyalty" class="section" tabindex="0" style="display:none;">
    <h2>Loyalty Points Management</h2>
    <p>Loyalty points are stored in localStorage and synced with e-commerce site.</p>
    <button id="resetPointsBtn" class="btn-danger">Reset Loyalty Points</button>
    <div id="loyaltyStatus" style="margin-top: 1rem;"></div>
  </div>

  <div id="reviews" class="section" tabindex="0" style="display:none;">
    <h2>Customer Reviews Moderation</h2>
    <div id="reviewsListContainer" style="max-height:400px;overflow-y:auto;">Loading reviews...</div>
  </div>
</div>

<script>
// Navigation toggle code
document.querySelectorAll('.menu-item').forEach(menuItem => {
  menuItem.addEventListener('click', () => {
    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    menuItem.classList.add('active');
    const sectionId = menuItem.getAttribute('data-section');
    const section = document.getElementById(sectionId);
    if(section){
      section.style.display = 'block';
      section.focus();
    }
    if(sectionId==='analytics' && typeof renderSalesChart === 'function') renderSalesChart();
    if(sectionId==='finances' && typeof updateFinances === 'function') updateFinances();
    if(sectionId==='loyalty') loadLoyaltyStatus();
    if(sectionId==='reviews') loadReviewsModeration();
  });
});

// Dark mode toggle code (same as before)

// Product management code

const productsTableBody = document.getElementById('productsList');
const productFormContainer = document.getElementById('productFormContainer');
const addNewProductBtn = document.getElementById('addNewProductBtn');
const cancelProductBtn = document.getElementById('cancelProductBtn');
let editProductId = null;

// Load and render product list from storage
function loadProducts() {
  let products = JSON.parse(localStorage.getItem('products') || '[]');
  productsTableBody.innerHTML = '';
  products.forEach(p => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>â‚¹${p.price.toFixed(2)}</td>
      <td>${p.stock}</td>
      <td>${p.desc || ''}</td>
      <td>
        <button data-id="${p.id}" class="edit-product-btn btn-warn">Edit</button>
        <button data-id="${p.id}" class="delete-product-btn btn-danger">Delete</button>
      </td>
    `;
    productsTableBody.appendChild(tr);
  });

  // Attach edit/delete events
  document.querySelectorAll('.edit-product-btn').forEach(btn => {
    btn.addEventListener('click', e => editProduct(e.target.dataset.id));
  });
  document.querySelectorAll('.delete-product-btn').forEach(btn => {
    btn.addEventListener('click', e => deleteProduct(e.target.dataset.id));
  });
}

addNewProductBtn.addEventListener('click', () => {
  clearProductForm();
  productFormContainer.style.display = 'block';
});

cancelProductBtn.addEventListener('click', () => {
  productFormContainer.style.display = 'none';
  clearProductForm();
});

document.getElementById('productForm').addEventListener('submit', e => {
  e.preventDefault();
  saveProduct();
});

function clearProductForm() {
  editProductId = null;
  document.getElementById('productName').value = '';
  document.getElementById('productCategory').value = '';
  document.getElementById('productPrice').value = '';
  document.getElementById('productStock').value = '';
  document.getElementById('productDesc').value = '';
}

function editProduct(id) {
  const products = JSON.parse(localStorage.getItem('products') || '[]');
  const product = products.find(p => p.id === id || p.id == id);
  if (!product) return alert('Product not found!');
  editProductId = product.id;
  document.getElementById('productName').value = product.name;
  document.getElementById('productCategory').value = product.category;
  document.getElementById('productPrice').value = product.price;
  document.getElementById('productStock').value = product.stock;
  document.getElementById('productDesc').value = product.desc || '';
  productFormContainer.style.display = 'block';
}

function saveProduct() {
  const name = document.getElementById('productName').value.trim();
  const category = document.getElementById('productCategory').value;
  const price = parseFloat(document.getElementById('productPrice').value);
  const stock = parseInt(document.getElementById('productStock').value);
  const desc = document.getElementById('productDesc').value.trim();

  if (!name || !category || isNaN(price) || isNaN(stock)) {
    return alert('Please fill all required fields correctly.');
  }

  let products = JSON.parse(localStorage.getItem('products') || '[]');
  if (editProductId) {
    const index = products.findIndex(p => p.id === editProductId);
    if (index !== -1) {
      products[index] = { id: editProductId, name, category, price, stock, desc };
    }
  } else {
    const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
    products.push({ id: newId, name, category, price, stock, desc });
  }
  localStorage.setItem('products', JSON.stringify(products));
  productFormContainer.style.display = 'none';
  clearProductForm();
  loadProducts();
  showToast('Product saved successfully.');
}

// Delete product
function deleteProduct(id) {
  if (!confirm('Are you sure you want to delete this product?')) return;
  let products = JSON.parse(localStorage.getItem('products') || '[]');
  products = products.filter(p => p.id !== parseInt(id));
  localStorage.setItem('products', JSON.stringify(products));
  loadProducts();
  showToast('Product deleted.');
}

// Loyalty points management as in previous

document.getElementById('resetPointsBtn').addEventListener('click', ()=> {
  localStorage.removeItem('loyaltyPoints');
  loadLoyaltyStatus();
});

function loadLoyaltyStatus(){
  const points = parseInt(localStorage.getItem('loyaltyPoints')||'0');
  document.getElementById('loyaltyStatus').textContent = `Total loyalty points stored: ${points}`;
}

// Reviews moderation as in previous step function loadReviewsModeration()

// Toast notification helper
let toastTimeout = null;
function showToast(message) {
  const toast = document.createElement('div');
  toast.className = 'toast show';
  toast.textContent = message;
  document.body.appendChild(toast);
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => {
    toast.classList.remove('show');
    document.body.removeChild(toast);
  },3000);
}

// Initialize product table on load
window.addEventListener('load', () => {
  loadProducts();
  loadLoyaltyStatus();
});
</script>
</body>
</html>
