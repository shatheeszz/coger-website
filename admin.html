<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coger Agri Admin Dashboard</title>
<style>
  /* Core Styles */
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    min-height: 100vh;
    color: #2c3e1f;
  }
  .sidebar {
    width: 260px;
    background: linear-gradient(180deg, #2d5016, #4a7c2c);
    color: white;
    padding-top: 20px;
    box-sizing: border-box;
  }
  .sidebar .logo {
    text-align: center;
    font-size: 26px;
    font-weight: bold;
    padding: 20px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    user-select: none;
  }
  .menu-item {
    padding: 15px 25px;
    cursor: pointer;
    border-left: 4px solid transparent;
    user-select: none;
  }
  .menu-item.active,
  .menu-item:hover {
    background: rgba(255, 255, 255, 0.1);
    border-left-color: #f4a259;
  }
  .main {
    flex: 1;
    padding: 20px 30px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 15px 25px;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    user-select: none;
  }
  button {
    cursor: pointer;
  }
  .btn-primary, .btn-danger {
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    color: white;
    font-weight: 600;
  }
  .btn-primary {
    background-color: #4a7c2c;
  }
  .btn-primary:hover {
    background-color: #2d5016;
  }
  .btn-danger {
    background-color: #d9534f;
  }
  .btn-danger:hover {
    background-color: #b52b27;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px 10px;
    text-align: left;
    vertical-align: middle;
  }
  input, select, textarea {
    width: 100%;
    padding: 8px 10px;
    margin-bottom: 12px;
    font-size: 14px;
    border-radius: 6px;
    border: 2px solid #4a7c2c;
    box-sizing: border-box;
  }
  textarea {
    resize: vertical;
  }
  #productFormContainer {
    border: 2px solid #4a7c2c;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 12px;
    max-width: 600px;
  }
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #4a7c2c;
    color: white;
    padding: 15px 25px;
    border-radius: 8px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-in-out;
    z-index: 10000;
  }
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }
  /* Dark mode */
  body.dark-theme {
    background: #121212;
    color: #eee;
  }
  body.dark-theme .top-bar {
    background: #222;
    box-shadow: 0 2px 12px rgba(255,255,255,0.1);
  }
  body.dark-theme .sidebar {
    background: linear-gradient(180deg, #90ee90, #6bbf6b);
    color: #121212;
  }
  body.dark-theme input, body.dark-theme select, body.dark-theme textarea {
    background: #2b3a22;
    color: #eee;
    border-color: #6bbf6b;
  }
  body.dark-theme table, body.dark-theme th, body.dark-theme td {
    border-color: #4f7a3f;
  }
</style>
</head>
<body>

<div class="sidebar" role="navigation" aria-label="Primary sidebar">
  <div class="logo">üåæ Coger Agri</div>
  <div class="menu-item active" data-section="dashboard" tabindex="0">üìä Dashboard</div>
  <div class="menu-item" data-section="products" tabindex="0">üì¶ Products</div>
  <div class="menu-item" data-section="loyalty" tabindex="0">‚≠ê Loyalty</div>
  <div class="menu-item" data-section="reviews" tabindex="0">üó£ Reviews</div>
</div>

<div class="main" role="main" tabindex="0">
  <div class="top-bar">
    <div class="title">Admin Dashboard</div>
    <button id="themeToggleBtn" class="btn-primary" aria-pressed="false" aria-label="Toggle dark mode">üåô Dark Mode</button>
  </div>

  <section id="dashboard" class="section" style="display: block;">
    <h2>Dashboard Overview</h2>
    <p>Welcome to Coger Agri Admin Panel.</p>
  </section>

  <section id="products" class="section" style="display:none;">
    <h2>Product Management</h2>
    <button id="addNewProductBtn" class="btn-primary" style="margin-bottom: 15px;">Add New Product</button>

    <div id="productFormContainer" style="display:none;">
      <form id="productForm">
        <label for="productName">Name *</label>
        <input type="text" id="productName" name="productName" required />

        <label for="productCategory">Category *</label>
        <select id="productCategory" name="productCategory" required>
          <option value="">--Select Category--</option>
          <option value="Cocopeat">Cocopeat</option>
          <option value="Oil">Oil</option>
          <option value="Coconut">Coconut</option>
          <option value="Copra">Copra</option>
          <option value="Charcoal">Charcoal</option>
        </select>

        <label for="productPrice">Price (‚Çπ)*</label>
        <input type="number" id="productPrice" name="productPrice" min="0" step="0.01" required />

        <label for="productStock">Stock Quantity *</label>
        <input type="number" id="productStock" name="productStock" min="0" required />

        <label for="productDesc">Description</label>
        <textarea id="productDesc" name="productDesc" rows="3"></textarea>

        <button type="submit" class="btn-primary">Save Product</button>
        <button type="button" id="cancelProductBtn" class="btn-danger" style="margin-left:10px;">Cancel</button>
      </form>
    </div>

    <table aria-label="Product list">
      <thead><tr><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Description</th><th>Actions</th></tr></thead>
      <tbody id="productsList"></tbody>
    </table>
  </section>

  <section id="loyalty" class="section" style="display:none;">
    <h2>Loyalty Points Management</h2>
    <button id="resetPointsBtn" class="btn-danger">Reset Loyalty Points</button>
    <p id="loyaltyStatus" style="margin-top: 10px;"></p>
  </section>

  <section id="reviews" class="section" style="display:none;">
    <h2>Customer Reviews Moderation</h2>
    <div id="reviewsListContainer" style="max-height:400px; overflow-y:auto;"></div>
  </section>
</div>

<div class="toast" id="toast" role="alert" aria-live="assertive" style="display:none;"></div>

<script>
  // Navigation
  const menuItems = document.querySelectorAll('.menu-item');
  const sections = document.querySelectorAll('.section');
  menuItems.forEach(item => {
    item.addEventListener('click', () => {
      menuItems.forEach(i => i.classList.remove('active'));
      sections.forEach(s => s.style.display = 'none');
      item.classList.add('active');
      const section = document.getElementById(item.dataset.section);
      if (section) section.style.display = 'block';
    });
  });

  // Dark Mode Toggle
  const themeToggleBtn = document.getElementById('themeToggleBtn');
  function applyTheme(theme) {
    if(theme === 'dark') {
      document.body.classList.add('dark-theme');
      themeToggleBtn.textContent = '‚òÄÔ∏è Light Mode';
      themeToggleBtn.setAttribute('aria-pressed', 'true');
    } else {
      document.body.classList.remove('dark-theme');
      themeToggleBtn.textContent = 'üåô Dark Mode';
      themeToggleBtn.setAttribute('aria-pressed', 'false');
    }
    localStorage.setItem('preferredTheme', theme);
  }
  themeToggleBtn.addEventListener('click', () => {
    const newTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';
    applyTheme(newTheme);
  });
  window.addEventListener('load', () => {
    const pref = localStorage.getItem('preferredTheme') || 'light';
    applyTheme(pref);
  });

  // Toast Notification
  const toast = document.getElementById('toast');
  let toastTimeout;
  function showToast(msg) {
    toast.textContent = msg;
    toast.style.display = 'block';
    clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => {
      toast.style.display = 'none';
    }, 3000);
  }

  // Product Management
  let products = JSON.parse(localStorage.getItem('products') || '[]');
  const productsList = document.getElementById('productsList');
  const productFormContainer = document.getElementById('productFormContainer');
  let editIndex = null;

  function renderProducts() {
    productsList.innerHTML = '';
    products.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.name}</td>
        <td>${p.category}</td>
        <td>‚Çπ${p.price.toFixed(2)}</td>
        <td>${p.stock}</td>
        <td>${p.desc || ''}</td>
        <td>
          <button data-index="${i}" class="edit-btn btn-primary">Edit</button>
          <button data-index="${i}" class="delete-btn btn-danger">Delete</button>
        </td>
      `;
      productsList.appendChild(tr);
    });
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', () => openEditForm(+btn.dataset.index));
    });
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', () => deleteProduct(+btn.dataset.index));
    });
  }
  renderProducts();

  document.getElementById('addNewProductBtn').addEventListener('click', () => {
    editIndex = null; 
    resetForm();
    productFormContainer.style.display = 'block';
  });

  document.getElementById('cancelProductBtn').addEventListener('click', () => {
    productFormContainer.style.display = 'none';
  });

  document.getElementById('productForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const name = e.target.productName.value.trim();
    const category = e.target.productCategory.value;
    const price = parseFloat(e.target.productPrice.value);
    const stock = parseInt(e.target.productStock.value);
    const desc = e.target.productDesc.value.trim();

    if(!name || !category || isNaN(price) || isNaN(stock)){
      alert('Please fill all required fields correctly.');
      return;
    }
    if(editIndex !== null){
      products[editIndex] = {name, category, price, stock, desc};
    } else {
      products.push({name, category, price, stock, desc});
    }
    localStorage.setItem('products', JSON.stringify(products));
    productFormContainer.style.display = 'none';
    renderProducts();
    showToast('Product saved successfully.');
  });

  function openEditForm(index) {
    editIndex = index;
    const p = products[index];
    const form = document.getElementById('productForm');
    form.productName.value = p.name;
    form.productCategory.value = p.category;
    form.productPrice.value = p.price;
    form.productStock.value = p.stock;
    form.productDesc.value = p.desc;
    productFormContainer.style.display = 'block';
  }

  function deleteProduct(index) {
    if(confirm('Delete this product?')){
      products.splice(index,1);
      localStorage.setItem('products', JSON.stringify(products));
      renderProducts();
      showToast('Product deleted.');
    }
  }

  function resetForm() {
    const form = document.getElementById('productForm');
    form.reset();
  }

  // Loyalty points basic
  const loyaltyStatus = document.getElementById('loyaltyStatus');
  document.getElementById('resetPointsBtn').addEventListener('click', () => {
    localStorage.removeItem('loyaltyPoints');
    updateLoyaltyStatus();
  });
  function updateLoyaltyStatus() {
    const pts = parseInt(localStorage.getItem('loyaltyPoints') || '0');
    loyaltyStatus.textContent = `Total loyalty points in system: ${pts}`;
  }
  updateLoyaltyStatus();

  // Reviews moderation
  const reviewsListContainer = document.getElementById('reviewsListContainer');
  function loadReviewsModeration() {
    reviewsListContainer.innerHTML = '';
    if(products.length === 0){
      reviewsListContainer.textContent = 'No products available.';
      return;
    }
    let hasReviews = false;
    products.forEach((p,i) => {
      const reviews = JSON.parse(localStorage.getItem(`reviews-${i}`) || '[]');
      if(reviews.length) {
        hasReviews = true;
        const div = document.createElement('div');
        div.innerHTML = `<h3>${p.name} Reviews</h3>`;
        reviews.forEach(r => {
          const pEl = document.createElement('p');
          pEl.textContent = `${'‚≠ê'.repeat(r.rating)} | ${new Date(r.date).toLocaleDateString()} | ${r.comment}`;
          div.appendChild(pEl);
        });
        reviewsListContainer.appendChild(div);
      }
    });
    if(!hasReviews){
      reviewsListContainer.textContent = 'No reviews submitted yet.';
    }
  }

  // Run reviews moderation content on reviews tab show
  menuItems.forEach(item => {
    if(item.dataset.section === 'reviews') {
      item.addEventListener('click', loadReviewsModeration);
    }
  });
</script>
</body>
</html>
