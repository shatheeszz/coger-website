<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coger Agri Admin Dashboard</title>

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2d5016" />

<style>
/* CSS Variables and Themes */
:root {
  --green: #2d5016;
  --light-green: #4a7c2c;
  --sage: #7fb069;
  --brown: #8b7355;
  --yellow: #f4a259;
  --bg: #f8f9f0;
  --white: #fff;
  --dark: #2c3e1f;
  --red: #d9534f;
  --orange: #f0ad4e;
  --success: #5cb85c;
}

body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--dark);
  margin: 0;
  display: flex;
  min-height: 100vh;
}
body.dark-theme {
  --green: #90ee90;
  --light-green: #6bbf6b;
  --sage: #a3d9a5;
  --brown: #5a4a3b;
  --yellow: #f0e68c;
  --bg: #121212;
  --white: #eeeeee;
  --dark: #e0e0e0;
  --red: #f08080;
  --orange: #f4a259;
  --success: #4caf50;
  background: var(--bg);
  color: var(--white);
}

/* Sidebar */
.sidebar {
  width: 260px;
  background: linear-gradient(180deg, var(--green), var(--light-green));
  color: white;
  position: fixed;
  top: 0; left: 0;
  height: 100vh;
  overflow-y: auto;
  padding-top: 20px;
  box-sizing: border-box;
}

.sidebar .logo {
  font-size: 26px;
  font-weight: bold;
  padding: 20px 0;
  text-align: center;
  user-select: none;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

.menu-item {
  padding: 15px 25px;
  cursor: pointer;
  border-left: 4px solid transparent;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s;
  user-select: none;
}

.menu-item:hover,
.menu-item.active {
  background: rgba(255, 255, 255, 0.1);
  border-left-color: var(--yellow);
}

/* Main content */
.main {
  margin-left: 260px;
  padding: 20px 30px;
  flex: 1;
  overflow-y: auto;
  background: var(--bg);
  min-height: 100vh;
  box-sizing: border-box;
}

/* Top bar */
.top-bar {
  background: white;
  padding: 15px 25px;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  user-select: none;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}
body.dark-theme .top-bar {
  background: #222;
  box-shadow: 0 2px 12px rgba(255,255,255,0.1);
  color: var(--white);
}

/* Buttons */
.btn-primary, .btn-warn, .btn-success, .btn-danger {
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  color: white;
  user-select: none;
  transition: background-color 0.3s ease;
}
.btn-primary { background-color: var(--light-green);}
.btn-primary:hover { background-color: var(--green);}
.btn-success { background-color: var(--success);}
.btn-danger { background-color: var(--red);}
.btn-warn { background-color: var(--orange);}
.btn-warn:hover { background-color: #cf8c46; }

/* Toast */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--green);
  color: white;
  padding: 15px 25px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease-in-out;
  z-index: 10000;
}
.toast.show {
  opacity: 1;
  pointer-events: auto;
}

/* General section container */
.section {
  display: none;
}
.section.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
table th, table td {
  border: 1px solid #ccc;
  padding: 8px 10px;
  text-align: left;
}
body.dark-theme table th,
body.dark-theme table td {
  border-color: #555;
}

/* Form Controls */
.search, select, input[type="text"], input[type="number"], textarea {
  padding: 8px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  font-size: 14px;
}

.search:focus, select:focus, input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
  outline: none;
  border-color: var(--sage);
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  align-items: center;
  justify-content: center;
  z-index: 2000;
}
.modal.show {
  display: flex;
}
.modal-content {
  background: var(--white);
  padding: 25px;
  border-radius: 12px;
  max-width: 600px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  color: var(--dark);
}
body.dark-theme .modal-content {
  background: #222;
  color: var(--white);
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}
.modal-header h2 {
  margin: 0;
}
.close {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 28px;
  color: #999;
}
.close:hover {
  color: var(--red);
}

/* Pagination */
.pagination {
  margin-top: 15px;
  display: flex;
  justify-content: center;
  gap: 8px;
}
.pagination button {
  padding: 6px 12px;
  border: 2px solid var(--light-green);
  background: white;
  color: var(--green);
  cursor: pointer;
  border-radius: 6px;
  font-weight: 600;
  transition: background-color 0.3s;
}
.pagination button:hover:not(.active) {
  background: var(--light-green);
  color: white;
}
.pagination button.active {
  background: var(--green);
  color: white;
  cursor: default;
}

/* Responsive */
@media (max-width: 768px) {
  .main {
    margin-left: 0;
    width: 100%;
  }
  .sidebar {
    width: 100%;
    height:auto;
    position: relative;
  }
  .top-bar {
    flex-direction: column;
    gap: 10px;
  }
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity: 1;}
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="logo">üåæ Coger Agri</div>
  <div class="menu-item active" data-section="dashboard">üìä Dashboard</div>
  <div class="menu-item" data-section="products">üì¶ Products</div>
  <div class="menu-item" data-section="orders">üõí Orders</div>
  <div class="menu-item" data-section="customers">üë• Customers</div>
  <div class="menu-item" data-section="analytics">üìà Analytics</div>
  <div class="menu-item" data-section="finances">üí∞ Finances</div>
</div>

<div class="main">

  <div class="top-bar">
    <div class="title">Admin Dashboard</div>
    <div>
      Admin User üå±
      <button id="themeToggleBtn" class="btn-warn" aria-pressed="false" aria-label="Toggle dark mode">üåô Dark Mode</button>
    </div>
  </div>

  <div style="margin-bottom:15px;display:flex;gap:10px;">
    <button onclick="exportTableToCSV('products.csv', 'productsTable')" class="btn-primary">Export Products</button>
    <button onclick="exportTableToCSV('orders.csv', 'ordersTable')" class="btn-primary">Export Orders</button>
    <button onclick="exportTableToCSV('customers.csv', 'customersTable')" class="btn-primary">Export Customers</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="section active">
    <h2>Welcome to Coger Agri Admin Dashboard</h2>
    <p>This is your dashboard overview.</p>
  </div>

  <!-- Products -->
  <div id="products" class="section">
    <h2>Product Management</h2>
    <input type="text" id="productSearch" placeholder="Search products..." class="search" />
    <table id="productsTable">
      <thead>
        <tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th></tr>
      </thead>
      <tbody id="productsList"></tbody>
    </table>
    <div class="pagination" id="productPagination"></div>
  </div>

  <!-- Orders -->
  <div id="orders" class="section">
    <h2>Order Management</h2>
    <input type="text" id="orderSearch" placeholder="Search orders..." class="search" />
    <table id="ordersTable">
      <thead>
        <tr><th>Order ID</th><th>Customer</th><th>Total</th><th>Status</th></tr>
      </thead>
      <tbody id="ordersList"></tbody>
    </table>
    <div class="pagination" id="orderPagination"></div>
  </div>

  <!-- Customers -->
  <div id="customers" class="section">
    <h2>Customer Management</h2>
    <input type="text" id="customerSearch" placeholder="Search customers..." class="search" />
    <table id="customersTable">
      <thead>
        <tr><th>Name</th><th>Email</th><th>Orders</th><th>Total Spent</th></tr>
      </thead>
      <tbody id="customersList"></tbody>
    </table>
    <div class="pagination" id="customerPagination"></div>
  </div>

  <!-- Analytics -->
  <div id="analytics" class="section">
    <h2>Sales Analytics</h2>
    <canvas id="salesChart" height="150"></canvas>
  </div>

  <!-- Finances -->
  <div id="finances" class="section">
    <h2>Financial Overview</h2>
    <canvas id="financeChart" height="150"></canvas>
  </div>

</div>

<!-- Customer Feedback Modal -->
<div id="feedbackModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="feedbackTitle" >
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="feedbackTitle">Customer Feedback</h2>
      <button id="feedbackCloseBtn" aria-label="Close feedback modal" class="close">&times;</button>
    </div>
    <div>
      <label for="rating">Rating:</label>
      <select id="rating" style="width:100%; margin:5px 0; padding:8px;">
        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="3">‚≠ê‚≠ê‚≠ê</option>
        <option value="2">‚≠ê‚≠ê</option>
        <option value="1">‚≠ê</option>
      </select>
    </div>
    <div>
      <label for="feedbackText">Feedback:</label>
      <textarea id="feedbackText" rows="4" style="width:100%; margin:5px 0; padding:8px;"></textarea>
    </div>
    <button id="submitFeedback" class="btn-primary" style="width:100%; margin-top:10px;">Submit</button>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Sample data for demos
  const products = [
    { id: 1, name: "Organic Seeds", category: "Seeds", price: 29.99, stock: 150, imageUrl:"https://via.placeholder.com/50?text=Seeds" },
    { id: 2, name: "Bio Fertilizer", category: "Fertilizers", price: 45.5, stock: 8, imageUrl:"https://via.placeholder.com/50?text=Fertilizer" },
    { id: 3, name: "Garden Tools Set", category: "Tools", price: 89.99, stock: 45, imageUrl:"https://via.placeholder.com/50?text=Tools" }
  ];
  const orders = [
    { id: 101, customer: "John Doe", total: 125.5, status: "Pending" },
    { id: 102, customer: "Jane Smith", total: 299.99, status: "Shipped" },
    { id: 103, customer: "Bob Johnson", total: 75.0, status: "Delivered" },
  ];
  const customers = [
    { name: "John Doe", email: "john@example.com", orders: 3, spent: 450 },
    { name: "Jane Smith", email: "jane@example.com", orders: 5, spent: 890 },
  ];

  // Sidebar navigation
  const menuItems = document.querySelectorAll('.menu-item');
  const sections = document.querySelectorAll('.section');
  menuItems.forEach(item => {
    item.addEventListener('click', () => {
      menuItems.forEach(i => i.classList.remove('active'));
      sections.forEach(s => s.classList.remove('active'));
      item.classList.add('active');
      const sectionId = item.getAttribute('data-section');
      document.getElementById(sectionId).classList.add('active');
      if(sectionId === 'analytics') renderSalesChart();
      if(sectionId === 'finances') renderFinanceChart();
    });
  });

  // Dark mode implementation
  const themeToggleBtn = document.getElementById("themeToggleBtn");
  function applyTheme(theme) {
    if (theme === "dark") {
      document.body.classList.add("dark-theme");
      themeToggleBtn.textContent = "‚òÄÔ∏è Light Mode";
      themeToggleBtn.setAttribute("aria-pressed", "true");
    } else {
      document.body.classList.remove("dark-theme");
      themeToggleBtn.textContent = "üåô Dark Mode";
      themeToggleBtn.setAttribute("aria-pressed", "false");
    }
    localStorage.setItem("preferredTheme", theme);
  }
  themeToggleBtn.addEventListener("click", () => {
    const currentTheme = localStorage.getItem("preferredTheme") || "light";
    const nextTheme = currentTheme === "dark" ? "light" : "dark";
    applyTheme(nextTheme);
  });
  window.addEventListener("DOMContentLoaded", () => {
    const storedTheme = localStorage.getItem("preferredTheme") || "light";
    applyTheme(storedTheme);
    loadProductsTable();
    loadOrdersTable();
    loadCustomersTable();
  });

  // Loaders for product/order/customer tables
  function loadProductsTable(filter='') {
    const tbody = document.getElementById('productsList');
    tbody.innerHTML = '';
    const filtered = products.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach(p => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><img src="${p.imageUrl}" alt="${p.name}" style="width:50px; border-radius:6px;"></td>
        <td>${p.name}</td><td>${p.category}</td><td>‚Çπ${p.price.toFixed(2)}</td><td>${p.stock}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function loadOrdersTable(filter='') {
    const tbody = document.getElementById('ordersList');
    tbody.innerHTML = '';
    const filtered = orders.filter(o => o.customer.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach(o => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${o.id}</td><td>${o.customer}</td><td>‚Çπ${o.total.toFixed(2)}</td><td>${o.status}</td>`;
      tbody.appendChild(tr);
    });
  }

  function loadCustomersTable(filter='') {
    const tbody = document.getElementById('customersList');
    tbody.innerHTML = '';
    const filtered = customers.filter(c => c.name.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach(c => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${c.name}</td><td>${c.email}</td><td>${c.orders}</td><td>‚Çπ${c.spent}</td>`;
      tbody.appendChild(tr);
    });
  }

  // Search inputs event listeners
  document.getElementById('productSearch').addEventListener('input', e => loadProductsTable(e.target.value));
  document.getElementById('orderSearch').addEventListener('input', e => loadOrdersTable(e.target.value));
  document.getElementById('customerSearch').addEventListener('input', e => loadCustomersTable(e.target.value));

  // Charts for Analytics and Finances
  let salesChartInstance, financeChartInstance;

  function renderSalesChart() {
    const ctx = document.getElementById('salesChart').getContext('2d');
    if(salesChartInstance) salesChartInstance.destroy();
    salesChartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
        datasets: [{
          label: 'Sales',
          data: [1200, 1900, 1500, 2200, 1700, 1400, 2100],
          borderColor: '#4a7c2c',
          backgroundColor: 'rgba(74,124,44,0.3)',
          fill: true,
          tension: 0.2
        }]
      },
      options: {responsive: true, scales: {y: {beginAtZero: true}}}
    });
  }

  function renderFinanceChart() {
    const ctx = document.getElementById('financeChart').getContext('2d');
    if(financeChartInstance) financeChartInstance.destroy();
    financeChartInstance = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Jan','Feb','Mar','Apr','May','Jun'],
        datasets: [
          {label:'Revenue', data:[10000, 12000, 15000, 13000, 16000, 18000], backgroundColor:'#4a7c2c'},
          {label:'Expenses', data:[8000, 9000, 11000, 9500, 10500, 7000], backgroundColor:'#d9534f'}
        ]
      },
      options: {responsive:true, scales: {y: {beginAtZero: true}}}
    });
  }

  // Feedback Modal
  const feedbackModal = document.getElementById('feedbackModal');
  const feedbackCloseBtn = document.getElementById('feedbackCloseBtn');
  const submitFeedbackBtn = document.getElementById('submitFeedback');
  feedbackCloseBtn.onclick = () => feedbackModal.style.display = 'none';
  window.onclick = e => { if(e.target===feedbackModal) feedbackModal.style.display='none'; };
  submitFeedbackBtn.onclick = () => {
    const rating = document.getElementById('rating').value;
    const feedbackText = document.getElementById('feedbackText').value.trim();
    if(!feedbackText) {
      alert('Please enter your feedback.');
      return;
    }
    console.log('Feedback:', {rating, feedbackText});
    showToast('Thanks for your feedback!');
    feedbackModal.style.display='none';
  };

  // Toast notification
  let toastTimeout;
  function showToast(msg, duration = 3000) {
    const toast = document.getElementById('toast');
    if(toastTimeout) clearTimeout(toastTimeout);
    toast.textContent = msg;
    toast.classList.add('show');
    toastTimeout = setTimeout(() => toast.classList.remove('show'), duration);
  }

  // CSV Export utility
  function exportTableToCSV(filename, tableId) {
    const rows = document.querySelectorAll(`#${tableId} tr`);
    const csv = [];
    rows.forEach(row => {
      const cols = row.querySelectorAll('td,th');
      const rowData = [];
      cols.forEach(col => rowData.push('"' + col.innerText.replace(/"/g, '""') + '"'));
      csv.push(rowData.join(','));
    });
    const csvString = csv.join('\n');
    const blob = new Blob([csvString], { type: 'text/csv' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
  }

  // Register service worker for PWA
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('service-worker.js')
      .then(()=>console.log('Service Worker registered'))
      .catch(()=>console.warn('Service Worker registration failed'));
  }
</script>

</body>
</html>
