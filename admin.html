<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coger Agri Admin Dashboard</title>

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2d5016" />

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- jsPDF libraries for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
/* CSS Variables and Themes */
:root {
  --green: #2d5016;
  --light-green: #4a7c2c;
  --sage: #7fb069;
  --brown: #8b7355;
  --yellow: #f4a259;
  --bg: #f8f9f0;
  --white: #fff;
  --dark: #2c3e1f;
  --red: #d9534f;
  --orange: #f0ad4e;
  --success: #5cb85c;
}

body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--dark);
  margin: 0;
  display: flex;
  min-height: 100vh;
}
body.dark-theme {
  --green: #90ee90;
  --light-green: #6bbf6b;
  --sage: #a3d9a5;
  --brown: #5a4a3b;
  --yellow: #f0e68c;
  --bg: #121212;
  --white: #eeeeee;
  --dark: #e0e0e0;
  --red: #f08080;
  --orange: #f4a259;
  --success: #4caf50;
  background: var(--bg);
  color: var(--white);
}

/* Sidebar */
.sidebar {
  width: 260px;
  background: linear-gradient(180deg, var(--green), var(--light-green));
  color: white;
  position: fixed;
  top: 0; left: 0;
  height: 100vh;
  overflow-y: auto;
  padding-top: 20px;
  box-sizing: border-box;
}

.sidebar .logo {
  font-size: 26px;
  font-weight: bold;
  padding: 20px 0;
  text-align: center;
  user-select: none;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

.menu-item {
  padding: 15px 25px;
  cursor: pointer;
  border-left: 4px solid transparent;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s;
  user-select: none;
}

.menu-item:hover,
.menu-item.active {
  background: rgba(255, 255, 255, 0.1);
  border-left-color: var(--yellow);
}

/* Main content */
.main {
  margin-left: 260px;
  padding: 20px 30px;
  flex: 1;
  overflow-y: auto;
  background: var(--bg);
  min-height: 100vh;
  box-sizing: border-box;
}

/* Top bar */
.top-bar {
  background: white;
  padding: 15px 25px;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  user-select: none;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}
body.dark-theme .top-bar {
  background: #222;
  box-shadow: 0 2px 12px rgba(255,255,255,0.1);
  color: var(--white);
}

/* Buttons */
.btn-primary, .btn-warn, .btn-success, .btn-danger {
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  color: white;
  user-select: none;
  transition: background-color 0.3s ease;
}
.btn-primary { background-color: var(--light-green);}
.btn-primary:hover { background-color: var(--green);}
.btn-success { background-color: var(--success);}
.btn-danger { background-color: var(--red);}
.btn-warn { background-color: var(--orange);}
.btn-warn:hover { background-color: #cf8c46; }

/* Toast */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--green);
  color: white;
  padding: 15px 25px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease-in-out;
  z-index: 10000;
}
.toast.show {
  opacity: 1;
  pointer-events: auto;
}

/* General section container */
.section {
  display: none;
}
.section.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
table th, table td {
  border: 1px solid #ccc;
  padding: 8px 10px;
  text-align: left;
  vertical-align: middle;
}
body.dark-theme table th,
body.dark-theme table td {
  border-color: #555;
}

/* Form Controls */
.search, select, input[type="text"], input[type="number"], input[type="date"], textarea {
  padding: 8px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  font-size: 14px;
  box-sizing: border-box;
}

.search:focus, select:focus, input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus, textarea:focus {
  outline: none;
  border-color: var(--sage);
}

/* Responsive */
@media (max-width: 768px) {
  .main {
    margin-left: 0;
    width: 100%;
  }
  .sidebar {
    width: 100%;
    height:auto;
    position: relative;
  }
  .top-bar {
    flex-direction: column;
    gap: 10px;
  }
}

/* Misc */
h2, h3 {
  margin-top: 0;
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar" role="navigation" aria-label="Primary sidebar">
  <div class="logo">ðŸŒ¾ Coger Agri</div>
  <div class="menu-item active" data-section="dashboard" tabindex="0">ðŸ“Š Dashboard</div>
  <div class="menu-item" data-section="products" tabindex="0">ðŸ“¦ Products</div>
  <div class="menu-item" data-section="orders" tabindex="0">ðŸ›’ Orders</div>
  <div class="menu-item" data-section="customers" tabindex="0">ðŸ‘¥ Customers</div>
  <div class="menu-item" data-section="analytics" tabindex="0">ðŸ“ˆ Analytics</div>
  <div class="menu-item" data-section="finances" tabindex="0">ðŸ’° Finances</div>
</div>

<div class="main" role="main">

  <div class="top-bar">
    <div class="title">Admin Dashboard</div>
    <div>
      Admin User ðŸŒ±
      <button id="themeToggleBtn" class="btn-warn" aria-pressed="false" aria-label="Toggle dark mode">ðŸŒ™ Dark Mode</button>
    </div>
  </div>

  <!-- Dashboard Section -->
  <div id="dashboard" class="section active" tabindex="0">
    <h2>Welcome to Coger Agri Admin Dashboard</h2>
    <p>This is your dashboard overview.</p>
    <p><strong>Summary:</strong></p>
    <ul>
      <li>Total Products: <span id="dashboardTotalProducts">0</span></li>
      <li>Total Orders: <span id="dashboardTotalOrders">0</span></li>
      <li>Total Customers: <span id="dashboardTotalCustomers">0</span></li>
      <li>Monthly Sales (â‚¹): <span id="dashboardMonthlySales">0.00</span></li>
    </ul>
  </div>

  <!-- Products Section -->
  <div id="products" class="section" tabindex="0">
    <h2>Product Management</h2>
    <input type="text" id="productSearch" placeholder="Search products..." class="search" />
    <table id="productsTable">
      <thead>
        <tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th></tr>
      </thead>
      <tbody id="productsList"></tbody>
    </table>
  </div>

  <!-- Orders Section -->
  <div id="orders" class="section" tabindex="0">
    <h2>Order Management</h2>
    <input type="text" id="orderSearch" placeholder="Search orders..." class="search" />
    <table id="ordersTable">
      <thead>
        <tr><th>Order ID</th><th>Customer</th><th>Total</th><th>Status</th></tr>
      </thead>
      <tbody id="ordersList"></tbody>
    </table>
  </div>

  <!-- Customers Section -->
  <div id="customers" class="section" tabindex="0">
    <h2>Customer Management</h2>
    <input type="text" id="customerSearch" placeholder="Search customers..." class="search" />
    <table id="customersTable">
      <thead>
        <tr><th>Name</th><th>Email</th><th>Orders</th><th>Total Spent</th></tr>
      </thead>
      <tbody id="customersList"></tbody>
    </table>
  </div>

  <!-- Analytics Section -->
  <div id="analytics" class="section" tabindex="0">
    <h2>Sales Analytics</h2>
    <canvas id="salesChart" height="150"></canvas>
  </div>

  <!-- Finances Section -->
  <div id="finances" class="section" tabindex="0" style="outline:none;">
    <h2>Financial Overview</h2>

    <!-- User Role Selection -->
    <div style="margin-bottom: 15px;">
      <label for="roleSelect">Current User Role: </label>
      <select id="roleSelect" style="padding:6px; min-width: 150px;">
        <option value="admin" selected>Admin</option>
        <option value="accountant">Accountant</option>
        <option value="viewer">Viewer</option>
      </select>
    </div>

    <!-- Summary Widgets -->
    <div id="financeWidgets" style="display:flex; gap: 20px; margin-bottom: 15px; flex-wrap: wrap;">
      <div class="finance-widget" style="flex:1; min-width:150px; background:var(--sage);color:#fff; padding:15px; border-radius:10px;">
        <strong>Total Expenses:</strong> <span id="widgetTotalExpenses">â‚¹0.00</span>
      </div>
      <div class="finance-widget" style="flex:1; min-width:150px; background:var(--light-green);color:#fff; padding:15px; border-radius:10px;">
        <strong>Total Returns:</strong> <span id="widgetTotalReturns">â‚¹0.00</span>
      </div>
      <div class="finance-widget" style="flex:1; min-width:150px; background:var(--yellow);color:#000; padding:15px; border-radius:10px;">
        <strong>Profit / Loss:</strong> <span id="widgetProfitLoss">â‚¹0.00</span>
      </div>
      <div class="finance-widget" style="flex:1; min-width:150px; background:var(--brown);color:#fff; padding:15px; border-radius:10px;">
        <strong>ROI %:</strong> <span id="widgetROI">0.00%</span>
      </div>
    </div>

    <!-- Profit/Loss Button -->
    <div style="margin-bottom: 15px;">
      <button id="profitLossBtn" class="btn-primary" style="font-size:16px; padding:10px 30px; width: fit-content;">
        Profit/Loss: â‚¹0.00
      </button>
    </div>

    <!-- Filters & Currency -->
    <div style="display:flex; align-items:center; gap:20px; margin-bottom: 10px; flex-wrap: wrap;">
      <label for="monthFilter">Select Month: </label>
      <input type="month" id="monthFilter" />

      <label for="currencySelect" style="white-space: nowrap;">Currency: </label>
      <select id="currencySelect" style="padding:6px;">
        <option value="INR" selected>â‚¹ INR</option>
        <option value="USD">$ USD</option>
        <option value="EUR">â‚¬ EUR</option>
        <option value="GBP">Â£ GBP</option>
      </select>
    </div>

    <!-- Budget Limits -->
    <div style="margin-bottom: 15px;">
      <h3>Budget Limits (per category)</h3>
      <div id="budgetLimitsContainer" style="display:flex; flex-wrap: wrap; gap: 10px;"></div>
    </div>

    <!-- Add Expense Form -->
    <div style="margin-bottom: 20px; border:1px solid #ccc; padding:15px; border-radius:10px; max-width:700px;">
      <h3>Add New Expense</h3>
      <form id="addExpenseForm" style="display:flex; flex-wrap: wrap; gap:10px; align-items: flex-end;">
        <div style="flex:1; min-width:120px;">
          <label for="expenseDate">Date</label>
          <input type="date" id="expenseDate" required style="width:100%; padding:6px;" />
        </div>
        <div style="flex:1; min-width:150px;">
          <label for="expenseCategory">Category</label>
          <select id="expenseCategory" required style="width:100%; padding:6px;"></select>
        </div>
        <div style="flex:1; min-width:100px;">
          <label for="expenseAmount">Amount</label>
          <input type="number" id="expenseAmount" min="0" step="0.01" required style="width:100%; padding:6px;" />
        </div>
        <div style="flex:2; min-width:200px;">
          <label for="expenseNotes">Notes</label>
          <input type="text" id="expenseNotes" placeholder="Optional notes" style="width:100%; padding:6px;" />
        </div>
        <div style="flex:1; min-width:120px; text-align:center;">
          <label for="recurringExpense" style="display:block;">Recurring?</label>
          <input type="checkbox" id="recurringExpense" />
        </div>
        <div style="flex:1; min-width:150px;">
          <label for="expenseAttachment">Receipt (Image)</label>
          <input type="file" id="expenseAttachment" accept="image/*" style="width:100%; padding:4px;" />
        </div>
        <div style="flex:1; min-width:120px; text-align:right;">
          <button type="submit" class="btn-primary" style="width:100%;">Add Expense</button>
        </div>
      </form>
      <div id="attachmentPreviewContainer" style="margin-top:8px;"></div>
    </div>

    <!-- Expense Table -->
    <table id="expenseTable" style="width:100%; margin-bottom:20px;">
      <thead>
        <tr>
          <th>Date</th>
          <th>Category</th>
          <th>Amount (â‚¹)</th>
          <th>Notes</th>
          <th>Recurring</th>
          <th>Receipt</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="expenseLogBody"></tbody>
    </table>

    <!-- Export Buttons -->
    <div style="margin-bottom:20px;">
      <button id="exportExpensesCSV" class="btn-primary">Export Expenses CSV</button>
      <button id="exportSummaryCSV" class="btn-primary" style="margin-left:10px;">Export Summary CSV</button>
      <button id="exportPDF" class="btn-primary" style="margin-left:10px;">Export PDF Report</button>
    </div>

    <!-- Charts -->
    <canvas id="expensesPieChart" height="200" style="margin-bottom: 30px;"></canvas>
    <canvas id="budgetBarChart" height="200"></canvas>

    <!-- Notifications -->
    <div id="financeNotification" role="alert" style="position: fixed; bottom: 20px; right: 20px; background: var(--yellow); color: black; padding: 12px 20px; border-radius: 10px; display:none; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index:10000;"></div>
  </div>
</div>

<!-- JavaScript -->
<script>
  // Sidebar and theme toggle omitted here for brevity (same as previous snippet)

  // Sample dummy data for demo
  const products = [
    { id: 1, name: "Organic Seeds", category: "Seeds", price: 29.99, stock: 150, imageUrl:"https://via.placeholder.com/50?text=Seeds" },
    { id: 2, name: "Bio Fertilizer", category: "Fertilizers", price: 45.5, stock: 8, imageUrl:"https://via.placeholder.com/50?text=Fertilizer" },
    { id: 3, name: "Garden Tools Set", category: "Tools", price: 89.99, stock: 45, imageUrl:"https://via.placeholder.com/50?text=Tools" }
  ];
  const orders = [
    { id: 101, customer: "John Doe", total: 125.5, status: "Pending" },
    { id: 102, customer: "Jane Smith", total: 299.99, status: "Shipped" },
    { id: 103, customer: "Bob Johnson", total: 75.0, status: "Delivered" },
  ];
  const customers = [
    { name: "John Doe", email: "john@example.com", orders: 3, spent: 450 },
    { name: "Jane Smith", email: "jane@example.com", orders: 5, spent: 890 },
  ];

  // Finance data structures and functions are integrated from previous advanced snippet 
  // Including expenses, budgets, roles, charts, exports, notifications, and event listeners.

  // For full readability and to avoid exceeding message length,
  // the full advanced Finance tab JavaScript code is in the next message.

  // Initialize UI data and event listeners on DOMContentLoaded
  window.addEventListener('DOMContentLoaded', () => {
    // Load dashboard summary
    document.getElementById('dashboardTotalProducts').textContent = products.length;
    document.getElementById('dashboardTotalOrders').textContent = orders.length;
    document.getElementById('dashboardTotalCustomers').textContent = customers.length;
    const monthlySales = orders.reduce((sum,o) => sum + o.total, 0);
    document.getElementById('dashboardMonthlySales').textContent = `â‚¹${monthlySales.toFixed(2)}`;
    
    // Load Products table
    loadProductsTable('');
    // Load Orders table
    loadOrdersTable('');
    // Load Customers table
    loadCustomersTable('');

    // Render sales chart
    renderSalesChart();

    // Initialize finance tab UI, charts etc.
    loadFinanceData();

    // Apply stored theme
    const storedTheme = localStorage.getItem('preferredTheme') || "light";
    applyTheme(storedTheme);
  });

  // Rest of the frontend finance tab JS will follow in the next message.
</script>

</body>
</html>
