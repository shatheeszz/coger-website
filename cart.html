<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Coger Enterprises</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="logo">Coger Enterprises</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#products">Products</a></li>
                <li><a href="cart.html" class="active">Cart <span id="cartBadge" class="cart-badge">0</span></a></li>
                <li><a href="login.html" id="authLink">Login</a></li>
            </ul>
        </div>
    </nav>

    <!-- Cart Content -->
    <div class="container">
        <h1>Shopping Cart</h1>
        
        <div id="cartContent">
            <div id="emptyCart" style="display: none;">
                <p>Your cart is empty.</p>
                <a href="index.html" class="btn">Continue Shopping</a>
            </div>
            
            <div id="cartItems" style="display: none;">
                <table class="cart-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="cartItemsBody">
                    </tbody>
                </table>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="cartSubtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (8%):</span>
                        <span id="cartTax">$0.00</span>
                    </div>
                    <div class="summary-row total">
                        <strong>Total:</strong>
                        <strong id="cartTotal">$0.00</strong>
                    </div>
                    <button class="btn btn-primary" onclick="checkout()">Proceed to Checkout</button>
                    <button class="btn" onclick="window.location.href='index.html'">Continue Shopping</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // Display cart items on page load
        window.addEventListener('DOMContentLoaded', () => {
            displayCart();
            updateAuthLink();
        });

        function displayCart() {
            const cart = getCart();
            const cartItemsBody = document.getElementById('cartItemsBody');
            const emptyCart = document.getElementById('emptyCart');
            const cartItems = document.getElementById('cartItems');
            const cartBadge = document.getElementById('cartBadge');
            
            if (cart.length === 0) {
                emptyCart.style.display = 'block';
                cartItems.style.display = 'none';
                cartBadge.textContent = '0';
                return;
            }
            
            emptyCart.style.display = 'none';
            cartItems.style.display = 'block';
            cartBadge.textContent = cart.length;
            
            cartItemsBody.innerHTML = '';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="cart-item-info">
                            <img src="${item.image || 'images/default-product.jpg'}" alt="${item.name}" class="cart-item-image">
                            <span>${item.name}</span>
                        </div>
                    </td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>
                        <div class="quantity-controls">
                            <button onclick="updateQuantity(${item.id}, -1)">-</button>
                            <span>${item.quantity}</span>
                            <button onclick="updateQuantity(${item.id}, 1)">+</button>
                        </div>
                    </td>
                    <td>$${itemTotal.toFixed(2)}</td>
                    <td>
                        <button class="btn-remove" onclick="removeFromCart(${item.id})">Remove</button>
                    </td>
                `;
                cartItemsBody.appendChild(row);
            });
            
            const tax = subtotal * 0.08;
            const total = subtotal + tax;
            
            document.getElementById('cartSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('cartTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('cartTotal').textContent = `$${total.toFixed(2)}`;
        }

        function updateQuantity(productId, change) {
            const cart = getCart();
            const item = cart.find(i => i.id === productId);
            
            if (item) {
                item.quantity += change;
                
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    localStorage.setItem('cart', JSON.stringify(cart));
                    displayCart();
                }
            }
        }

        function removeFromCart(productId) {
            let cart = getCart();
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
            showToast('Item removed from cart');
        }

        function checkout() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                showToast('Please login to proceed with checkout', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
                return;
            }
            
            const cart = getCart();
            if (cart.length === 0) {
                showToast('Your cart is empty', 'error');
                return;
            }
            
            // TODO: Implement checkout process
            showToast('Checkout functionality coming soon!');
        }

        function updateAuthLink() {
            const token = localStorage.getItem('token');
            const authLink = document.getElementById('authLink');
            
            if (token) {
                authLink.textContent = 'Logout';
                authLink.href = '#';
                authLink.onclick = (e) => {
                    e.preventDefault();
                    logout();
                };
            }
        }
    </script>
</body>
</html>
