<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Coger Enterprises</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="logo">Coger Enterprises</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#products">Products</a></li>
                <li><a href="cart.html">Cart <span id="cartBadge" class="cart-badge">0</span></a></li>
                <li><a href="login.html" id="authLink">Login</a></li>
            </ul>
        </div>
    </nav>

    <!-- Product Details -->
    <div class="container">
        <div id="productDetails" class="product-details">
            <div class="product-image-container">
                <img id="productImage" src="" alt="Product" class="product-detail-image">
            </div>
            
            <div class="product-info-container">
                <h1 id="productName">Loading...</h1>
                <p class="product-price">$<span id="productPrice">0.00</span></p>
                <p id="productDescription" class="product-description"></p>
                
                <div class="product-meta">
                    <p><strong>Category:</strong> <span id="productCategory"></span></p>
                    <p><strong>Stock:</strong> <span id="productStock"></span> units available</p>
                </div>
                
                <div class="product-actions">
                    <div class="quantity-selector">
                        <label for="quantity">Quantity:</label>
                        <input type="number" id="quantity" value="1" min="1" max="99">
                    </div>
                    <button class="btn btn-primary" onclick="addProductToCart()">Add to Cart</button>
                    <button class="btn" onclick="window.location.href='index.html'">Back to Products</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script>
        let currentProduct = null;

        // Load product details on page load
        window.addEventListener('DOMContentLoaded', async () => {
            updateCartBadge();
            updateAuthLink();
            await loadProductDetails();
        });

        async function loadProductDetails() {
            // Get product ID from URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (!productId) {
                showToast('No product specified', 'error');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
                return;
            }
            
            try {
                const product = await apiCall(`/products/${productId}`);
                currentProduct = product;
                displayProduct(product);
            } catch (error) {
                showToast('Failed to load product details', 'error');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        }

        function displayProduct(product) {
            document.getElementById('productName').textContent = product.name;
            document.getElementById('productPrice').textContent = product.price.toFixed(2);
            document.getElementById('productDescription').textContent = product.description || 'No description available.';
            document.getElementById('productCategory').textContent = product.category || 'General';
            document.getElementById('productStock').textContent = product.stock || 0;
            document.getElementById('productImage').src = product.image || 'images/default-product.jpg';
            document.getElementById('productImage').alt = product.name;
            
            // Update quantity max based on stock
            const quantityInput = document.getElementById('quantity');
            quantityInput.max = product.stock || 1;
            
            // Update page title
            document.title = `${product.name} - Coger Enterprises`;
        }

        function addProductToCart() {
            if (!currentProduct) {
                showToast('Product not loaded', 'error');
                return;
            }
            
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (quantity < 1) {
                showToast('Please select a valid quantity', 'error');
                return;
            }
            
            if (quantity > currentProduct.stock) {
                showToast('Not enough stock available', 'error');
                return;
            }
            
            // Add to cart multiple times based on quantity
            for (let i = 0; i < quantity; i++) {
                addToCart(currentProduct);
            }
            
            showToast(`${quantity} item(s) added to cart`);
            updateCartBadge();
        }

        function updateCartBadge() {
            const cart = getCart();
            document.getElementById('cartBadge').textContent = cart.length;
        }

        function updateAuthLink() {
            const token = localStorage.getItem('token');
            const authLink = document.getElementById('authLink');
            
            if (token) {
                authLink.textContent = 'Logout';
                authLink.href = '#';
                authLink.onclick = (e) => {
                    e.preventDefault();
                    logout();
                };
            }
        }
    </script>
</body>
</html>
